#! /usr/bin/env python3
import PdfFileReader as PyPDF2
import re
import csv
import sys
import os

def statementToCSV(csvFile, pdfFile):
    pdfFile = open(pdfFile, 'rb')
    pdfReader = PyPDF2.PdfFileReader(pdfFile)
    # Create a csv file
    csvFile = open(csvFile, 'w', newline='')
    csvWriter = csv.writer(csvFile)
    # Read the pdf file
    for pageNum in range(pdfReader.numPages):
        pageObj = pdfReader.getPage(pageNum)
        text = pageObj.extract_text()
        # Extract the date, description, and amount from the text
        date = re.findall(r'\d{2}/\d{2}/\d{4}', text)
        description = re.findall(r'[A-Z].*', text)
        amount = re.findall(r'\d+\.\d+', text)

        # Write the data to the csv file
        for i in range(len(date)):
            csvWriter.writerow([date[i], description[i], amount[i]])
    # Close the files
    pdfFile.close()
    csvFile.close()

if __name__ == '__main__':
    print('Running statementToCSV.py')
    if len(sys.argv) != 3:
        print('Usage: python statementToCSV.py <csvFile> <pdfFile>')
        sys.exit()
    statementToCSV(sys.argv[1], sys.argv[2])
